/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_printf.c                                        :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: bmiklaz <marvin@42.fr>                     +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/01/24 20:46:52 by bmiklaz           #+#    #+#             */
/*   Updated: 2019/02/13 18:07:32 by jziemann         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ft_printf.h"

int			take_val(t_vap_data_t *begin, int i)
{
	while (begin->ind != i)
		begin = begin->next;
	return (begin->data->i);
}

void		create_pr_data(t_vap_data_t *begin)
{
	t_vap_data_t	*node;
	int				i;

	node = begin;
	while (begin)
	{
		begin->dot = begin->dot < 0 ? take_val(node, -begin->dot) : begin->dot;
		begin->width = begin->width < 0 ? take_val(node, -begin->width) : begin->width;
		if (begin->type == 'f')
		{
			if (begin->size_flags[2])
				begin->pr_data = ftoa(ft_dvigai_tochku(begin->data->lf, begin->dot, &i), begin->dot, i);
			else
				begin->pr_data = ftoa(ft_dvigai_tochku(begin->data->f, begin->dot, &i), begin->dot, i);
		}
		if (ft_strchr("idouxX", begin->type))
			pr_data_for_nbr(begin);
		if (begin->type == 's')
			begin->pr_data = ft_strdup(begin->data->p);
		if (begin->type == 'c')
		{
			begin->pr_data = ft_strnew(1);
			(begin->pr_data)[0] = begin->data->c;
		}
		if (!(begin = begin->next))
			return ;
	}
}

#include <stdio.h>

void		ft_printf(char *str, ...)   //TODO dont work. need fix.
{
	t_vap_data_t	*begin;
	va_list			args;

	pars_flags((begin = ft_make_vaplist(str)));
	va_start(args, str);
	read_pr_va_list(begin, args);
	va_end(args);
	create_pr_data(begin);
	while (begin)
	{
		printf("_____\nnode : <%p>\n\ndata : <%hd>\npr_data : <%s>\nflags : <%s>\nstart : %s\nfinish : %s\nnext : <%p>\nind : %d\nwidth : %d\ndot : %d\nbax : %d\nsize_flags : %d %d %d\ntype : %c\nf_hash : %d\nf_apostrophe : %d\nf_minus : %d\nf_plus : %d\nf_space : %d\nf_star : %d\nf_dot : %d\nf_zero : %d\n",
				begin, B(data)->h, B(pr_data), B(flags), B(start), B(finish), B(next), B(ind), B(width), B(dot), B(bax), B(size_flags)[0], B(size_flags)[1], B(size_flags)[2], B(type), B(f_hash), B(f_apostrophe), B(f_minus), B(f_plus), B(f_space), B(f_star), B(f_dot), B(f_zero));
		begin = begin->next;
	}
}

char	*ft_strrev(char *str)
{
	char *r;
	int i = 0;
	int len;
	len = ft_strlen(str);

	r = ft_strnew(len);
	while (--len >= 0)
		r[i++] = str[len];
	return r;
}

int		main(int argc, char **argv) {
	//ft_printf("%c %d %.*2$Lf", 'c', 10, 10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0L);
	//long double  test = 7.8974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974897489748974L;
	//printf("\n\n\n%Llf", test);	//printf("\n%ld", 9223372036854775098 - 9223372036854775097);
	//ft_printf("\n\n%o", -1);
	//printf("%lx", (long)-1);
	//123.456
	//int i = 0;
	//printf("\n%s", ftoa(ft_dvigai_tochku(-123.12345, 4, &i), 4, i));
	t_vector *test;
	test = long_pow('5', 50000);
	//char *s = "qwer";
	//printf("%zu", ft_strlen(s));
	printf("%s", ft_strrev(test->v));
	return (0);
}
